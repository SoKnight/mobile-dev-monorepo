# Приложение на React Native с картой и локальной БД

Мобильное приложение с картой и локальной БД, реализованное на React Native / Expo и позволяющее:
- Изучать карту, находить интересные места
- Добавлять маркеры в найденных местах
- Задавать заголовок и описание каждому маркеру
- Прикреплять фотографии к маркерам
- Удалять фотографии и маркеры

**Выполнил: Пермяков Константин, ИПО-4**

## Основные требования

> [!IMPORTANT]
> Перечисленные ниже требования относятся именно к тому сценарию, когда приложение запускается через Expo Go на Android-устройстве.
> Требования в случае запуска на iOS-устройстве или в web-версии не задокументированы.

1. Необходимые зависимости должны быть установлены:
   ```bash
   npm install
   ```
2. Миграции Drizzle должны быть сгенерированы:
   ```bash
   npx drizzle-kit generate
   ```
3. Android-устройство должно быть подключено к одной WiFi сети вместе с ПК.

## Запуск

Для запуска приложения сначала необходимо запустить Expo Go сервер на ПК:
```bash
npx expo start
```

Далее необходимо подключиться к серверу с Android-устройства:
- **Через ADB (Android Debug Bridge)**
  Нажмите `a` в терминале сервера Expo Go, чтобы запустить приложение
> [!WARNING]
> Android-устройство должно быть подключено по ADB к ПК через кабель или WiFi.
- **Через QR-код**
  Отсканируйте QR-код в терминале сервера Expo Go с Android-устройства, чтобы запустить приложение

## Схема БД

### Маркеры на карте
Название таблицы: `map_markers`

Ограничения:
- Имеет первичный ключ `id`

| Колонка       | Тип данных | Определение                          | Назначение                           |
|---------------|------------|--------------------------------------|--------------------------------------|
| `id`          | `integer`  | `PRIMARY KEY AUTOINCREMENT NOT NULL` | Уникальный ID маркера                |
| `location`    | `text`     | `NOT NULL`                           | Местоположение маркера (LatLng JSON) |
| `title`       | `text`     |                                      | Заголовок маркера                    |
| `description` | `text`     |                                      | Описание маркера                     |
| `created_at`  | `integer`  | `NOT NULL`                           | Временная метка создания             |
| `updated_at`  | `integer`  | `NOT NULL`                           | Временная метка обновления           |

### Изображения/фото маркеров
Название таблицы: `map_marker_images`

Ограничения:
- Имеет первичный ключ `id`
- Имеет внешний ключ к `map_markers.id` через `marker_id`

| Колонка      | Тип данных | Определение                          | Назначение                       |
|--------------|------------|--------------------------------------|----------------------------------|
| `id`         | `integer`  | `PRIMARY KEY AUTOINCREMENT NOT NULL` | Уникальный ID изображения        |
| `marker_id`  | `integer`  | `NOT NULL`                           | ID маркера-владельца             |
| `url`        | `text`     | `NOT NULL`                           | Местоположение файла изображения |
| `created_at` | `integer`  | `NOT NULL`                           | Временная метка добавления       |

## Особенности реализации

Для хранения данных между сессиями в приложении используется локальная БД SQLite, работа с которой
происходит с помощью `expo-sqlite` в качестве драйвера и `Drizzle` в качестве ORM-фреймворка.

Схема базы данных описывается в `database/schema.ts`, сама БД инициализируется в `database/init.ts`,
а операции с ней (контекст, DAO) описываются в `database/operations.ts`. Для взаимодействия с БД со
стороны графического интерфейса используется создания и передачи контекстов в React Native. Контекст
БД создается в `context/DatabaseContext.tsx`, а затем передается «оборачиванием» декларации роутинга
в `DatabaseProvider` в `app/_layout.tsx`.

Приложение умеет в миграции благодаря всё тому же Drizzle Kit, файлы миграций генерируются отдельно
командой `npx drizzle-kit generate`, которая должна быть выполнена один раз для последующих запусков
приложения, о чем написано выше.

В графическом интерфейсе используется собственный хук `useDatabase` для доступа к операциям в контексте БД,
а также хуки `useFocusEffect` и `useEffect` в зависимости от ситуации для загрузки данных из БД и хранения
их в состоянии.

## License

This project is open-source and licensed under the [MIT license](/LICENSE).
